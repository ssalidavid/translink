// default render page
$(document).ready(function() {
    var data = {stdname:"",gender:"", admission: "", stdclass: "", stream:"", name:"", 
    start_date: "", end_date: ""};
    generate_students_details(data);
});

// render date datewise
$(document).on('click','#filter-students', function(){   
    var stdname = $('input#stdname').val();
    var gender = $('select#filter-gender').val(); 
    var admission = $('select#admission').val();    
    var stdclass = $('select#stdclass').val();
    var stream = $('select#stream').val();
    var startDate = $('input#start-date').val();    
    var endDate = $('input#end-date').val();
    var data = {stdname:stdname,gender:gender, admission:admission, 
        stdclass:stdclass, stream:stream, startDate:startDate, endDate:endDate};
    generate_students_details(data);
});
// generate Element Table
function generate_students_details(element){
    var admission = $('select#admission').val();  	
    var logo = baseURL+ 'uploads/logo/'+syslogo;
    var start_date = $('input#start-date').val(); 
    var end_date = $('input#end-date').val();
    var stadmission, date_range;
    if (start_date !== '' && end_date !== '' && admission != '') {
        date_range = 'From '+start_date+' To '+end_date;
        stadmission = admission;
    }else if (admission != '') {
        stadmission = admission;
        date_range = 'Printed On '+currentDate;
    } else{
        date_range = 'Printed On '+currentDate; 
        stadmission = '';
    }
    $.ajax({
        url: baseURL + 'admin/reports/generate_students_information',
        data: {'stdname' : element.stdname,'gender' : element.gender,
            'admission' : element.admission , 'stdclass' : element.stdclass,
            'stream' : element.stream,
            'start_date' : element.startDate , 'end_date' : element.endDate},
        type: 'post', 
        dataType: 'json',
        beforeSend: function () {
            $('#generate_students').html('<div class="text-center">'+
                '<i class="fa fa-spinner fa-pulse fa-4x fa-fw"></i></div>');
        },			 
        success: function (html) {
            var dataTable='<table id="students_table" class="table table-striped"'+
            'cellspacing="0" width="100%"></table>';
            $('#generate_students').html(dataTable);		
            var table = $('#students_table').DataTable({
                data: html.data,
                "bPaginate": true,
                "bLengthChange": true,
                "pageLength" : 25,
                "lengthMenu" : [[10,25,50,100],[10,25,50,100]],
                "bFilter": false,
                "bInfo": true,
                "bAutoWidth": true,
                columns: [
                { title: "S.No", "width": "2%"},
                { title: "Student Name", "width": "20%"},
                { title: "Gender", "width": "12%"},
                { title: "Date of Birth", "width": "12%"},
                { title: "Class", "width": "2%"},
                { title: "Address", "width": "12%"},				
                { title: "Admission Date", "width": "12%"}
                ],
                dom: 'lBfrtip',
                buttons: [
                //'copy','csv', 'excel', 'pdf', 'print'
                {
                    extend: 'excel',
                    className: 'btn btn-secondary',
                    titleAttr: 'Excel Export',
                    text: '<i class="fa fa-file-excel-o"></i>',
                    filename: ''+stadmission+' Students',
                    title: ''+stadmission+' Students Information',
                    extension: '.xlsx'
                },
                {
                    extend: 'csv',
                    className: 'btn  btn-primary',
                    titleAttr: 'CSV Export',
                    text: '<i class="fa fa-bars"></i>',
                    filename: ''+stadmission+' Students',
                    title: ''+stadmission+' Students Information',
                    extension: '.csv'
                },
                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body)
                        .css('font-size', '10pt')
                        .prepend(
                        '<img src='+logo+' style="position:absolute; top:0;'+
                        ' left:0;height:90px" />'
                        );
                        $(win.document.body).find('table')
                        .addClass('compact')
                        .css('font-size', 'inherit');
                    },
                    className: 'btn btn-secondary',
                    titleAttr: 'Print Export',
                    text: '<i class="fa fa-print"></i>',
                    title: '<h3>'+sysname+'</h3>'+
                    '<h4 class="text-center">'+stadmission+' Students Information</h4>'+
                    '<h5 class="text-center">'+ date_range+'</h5>',
                },                
                ],
            });
        }		 
    });
}

// get DatePicker
$(document).on('focus', '.getDatePicker', function () {
    $(this).datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "yy-mm-dd",
        yearRange: "2012:2050"
    });
});
